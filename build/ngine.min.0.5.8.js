/*! Ngine 0.5.8 | (c) Christian Westman | GNU General Public License v3.0 | https://nginejs.com */
"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var _this=void 0;window.$ngine={cache:{},version:"dev",state:{ready:!1,queue:[]},settings:{disableCache:!1},loadConfig:function(e){window.$ngine.state.ready=!1,$ngine.load(e,function(e){if("object"==_typeof(e)){var n=$ngine.parseConfig(e);for(var t in n)$ngine.settings[t]=n[t]}window.$ngine.state.ready=!0;for(var r=0;r<$ngine.state.queue.length;r++){var i=$ngine.state.queue[r];i.func.apply(_this,i.args)}},0,!0,!0)},parseConfig:function(e){var n=function(e,n){for(var t in n)e[t]=n[t];return e},t=n({},e);if("object"==_typeof(t.whitelist)){var r=[];for(var i in t.whitelist){var o=new RegExp(i,"ig"),a=n({},t.whitelist[i]);a.str=i,a.expr=o,r.push(a)}r.sort(function(e,n){return e.str.localeCompare(n.str)}),t.whitelist=r.reverse()}return t},getUrlSettings:function(e,n){if(Array.isArray($ngine.settings.whitelist)){var t=$ngine.settings.whitelist.filter(function(n){return null!=e.match(n.expr)});if(0==t.length)throw{message:"url: "+e+" does not match any whitelist entry defined in ngine.json"};return t[0]}return n},interpolate:function(e,n,t,r,i){i=void 0===i?0:i,t=void 0===t?0:t;var o=0;t+=e.substr(0,o).split("\n").length;for(var a=-1,l=!1,u=!1,c=null,s=[],d=["'",'"',"`"],g=null,f=o,p=0,v=function(){var n=e[h];if(c=null==c?d.filter(function(e){return e==n})[0]:n==c?null:c,d.filter(function(e){return e==n})[0]&&(s[s.length-1]==n?s.pop():s.push(n)),"{"==n&&l&&(o=u?o:h,u&&(a++,p++),u=!0),"{"==n&&!l&&u&&p++,l="$"==n,"}"==n&&0==p&&u&&0==Math.max(0,a-1)){if(0==(a=Math.max(0,a-1))&&u)return g=e.substr(o+1,h-o-1),f=o+g.length+2,"break"}else"}"==n&&(a=Math.max(0,a-1),p=Math.max(0,p-1))},h=o;h<e.length;h++){if("break"===v())break}if(!g)return e.toString();if(g=$ngine.interpolate(g,n,t,r,i+1),g=null!=c&&i>0?c+"+ ( "+g+" ) +"+c:g,i>0)return $ngine.interpolate(e.substr(0,o-1)+g+e.substr(f),n,t,r,i+1);var m=e.substr(0,o-1)+n(g,t,r)+e.substr(f);return $ngine.interpolate(m,n,t,r).toString()},load:function(e,n,t,r,i){var o=$ngine.getUrlSettings(e,$ngine.settings),a=new XMLHttpRequest;e=function(e){var n=document.createElement("a");n.href=e;var t=n.href.split("?")[1]?n.href.split("?")[1].split("&"):[],r=["_ngine_cache_buster="+$ngine.version+(new Date).getTime()+(1e3+Math.floor(1e3*Math.random()))],a=(t=(t=o.disableCache||!0===i?t.concat(r):t).filter(function(e){return"_ngine_model"!=e.split("=")[0]}))?"?"+t.join("&"):"",l=n.protocol||n.protocol.length>0?n:window.location;return l.protocol+"//"+(l.host+"/"+n.pathname).replace("//","/")+a}(e),a.addEventListener("load",function(t){var r=t.target.getResponseHeader("content-type")||"",i=function(){var n=404==t.target.status?'{ "error" : "404 not found \''+e+"' \" }":t.target.responseText;return n=r.indexOf("application/json")>=0?JSON.parse(n):n}(),o=t.target.id;return n(i,o,e)}),a.addEventListener("error",function(e,n,t){console.log(e,n,t)}),a.id=t,a.open("GET",e),a.send()},reload:function(e){var n=$ngine.cache[e].model,t="function"==typeof n?function(e){n(e)}:"string"==typeof n?function(t){$ngine.load(n,t,e,!0)}:function(e){e(n)};$ngine.render($ngine.cache[e].url,t,function(n,t){for(var r=$ngine.cache[e].elements[0],i=0;i<$ngine.cache[e].elements.length&&(void 0===r.parentNode||null==r.parentNode);i++)r=$ngine.cache[e].elements[i];var o=document.createElement("div");r.parentNode.insertBefore(o,r);for(i=0;i<$ngine.cache[e].elements.length;i++){var a=$ngine.cache[e].elements[i];a.parentNode&&a.parentNode.removeChild(a)}$ngine.apply(o,t,n)})},apply:function(e,n,t){if(void 0!==e&&null!=e)if(e.outerHTML){e.innerHTML=t,$ngine.cache[n].elements=[];for(var r=0;r<e.childNodes.length;r++)$ngine.cache[n].elements.push(e.childNodes[r]);for(var i=0;i<$ngine.cache[n].elements.length;i++){var o=$ngine.cache[n].elements[i];o.parentNode.removeChild(o),e.parentNode.insertBefore(o,e)}e.parentNode.removeChild(e);var a=$ngine.cache[n].elements.filter(function(e){return"SCRIPT"==e.nodeName}),l=a.filter(function(e){return null!=e.getAttribute("src")}),u=a.filter(function(e){return e.innerHTML.trim().length>0}),c=l.length,s=function(e,n){return function(){--e<=0&&n.forEach(function(e){e.parentNode.removeChild(e);var n=document.createElement("script");n.setAttribute("type","text/javascript"),n.innerHTML=e.innerHTML,document.body.appendChild(n)})}}(c,u);0==c&&s(),l.forEach(function(e){e.parentNode.removeChild(e);var n=document.createElement("script");n.setAttribute("src",e.getAttribute("src")),n.setAttribute("type","text/javascript"),n.addEventListener("load",s),document.body.appendChild(n)})}else{var d=document.createElement("div");d.innerHTML="\x3c!--8a002e27-eca8-4fdc-9b1b-41d2c1468d5f--\x3e";var g=e.parentNode;g.replaceChild(d,e),$ngine.cache[n].elements=[d],g.innerHTML=g.innerHTML.replace("<div>"+d.innerHTML+"</div>",t)}else console.log("unable to ngine.apply:",n)},util:{string:{flatten:function(e){for(var n=!1,t="",r=['"',"'","`"],i=void 0,o=0;o<e.length;o++){var a=e[o];n=(!n||"`"!=a)&&("`"==a||n),i=void 0===i?r[r.indexOf(a)]:i==r[r.indexOf(a)]?void 0:i,"\r"==a||(t+="\n"==a&&void 0!==i?"\\n":"`"==a?'"':'"'==a&&n?'\\"':a)}return t}}},eval:function(e,n,t){var r=function(){var e={};if("object"==_typeof($ngine.settings.env))for(var n in $ngine.settings.env)e[n]=$ngine.settings.env[n];var r={model:t.model,model_url:t.model_url,_ngine_template_instance_id_:t.id,_ngine_template_url_:t.template_url,_ngine_model_url_:t.model_url,_ngine_version_:$ngine.version};for(var n in r)e[n]=r[n];return e}();console.log(r);var i=t.url;e=$ngine.util.string.flatten(e);try{var o=Object.keys(r),a=Object.keys(r).map(function(e){return r[e]});o.push("render"),a.push(function(e,n){var r=$ngine.getUrlSettings(e,$ngine.settings),i=void 0===(n=void 0===n&&void 0!==r.model?r.model:n);return n=void 0===n?t.getModel:n,$ngine.render(e,n,function(e,n){var t=document.getElementById(n);$ngine.apply(t,n,e)},i?t:void 0)});var l="function("+o.join(",")+"){ return ("+e+") }";return Function('"use strict";return ('+l+")")().apply(void 0,_toConsumableArray(a))}catch(t){return console.log({message:t.message,expression:e,line:n,file:i,exception:t}),'{{  "'+t.message+'"  }}'}},navigate:function(e,n,t){if(!$ngine.state.ready)return $ngine.state.queue.push({func:$ngine.navigate,args:arguments});if(!$ngine.state.hashchange){$ngine.state.hashchange=!0;var r=function(){if(0==window.location.hash.indexOf("#!")){var e=window.location.hash.substr(2),n=(e.split("?")[1]?e.split("?")[1].split("&"):[]).map(function(e){return"_ngine_model"==e.split("=")[0]?decodeURIComponent(e.split("=")[1]):null}).filter(function(e){return null!=e}).map(function(e){return e&&"{"==e[0]?JSON.parse(e):e})[0],t=$ngine.cache[e]?$ngine.cache[e].model:n||void 0,r=$ngine.cache[e]?$ngine.cache[e].callback:void 0;$ngine.render(e,t,r)}};if(window.addEventListener("hashchange",r,!1),0==window.location.hash.indexOf("#!"))return r()}$ngine.cache[e]={model:n,callback:t},e=function(e){if(void 0===n)return e;var t=e.split("?")[1]?e.split("?")[1].split("&"):[];e=e.split("?")[0];var r="object"==_typeof(n)?JSON.stringify(n):n;return e+((t=t.concat(["_ngine_model="+encodeURIComponent(r)]))?"?"+t.join("&"):"")}(e),window.location.hash="#!"+e},render:function(e,n,t,r){if(!$ngine.state.ready)return $ngine.state.queue.push({func:$ngine.render,args:arguments});var i=$ngine.getUrlSettings(e,$ngine.settings);n=void 0===n&&void 0!==i.model?i.model:n,t=void 0===t&&void 0!==i.target?i.target:t;var o=1e5+Math.floor(1e5*Math.random())+"_"+(new Date).getTime(),a="function"==typeof e?function(n){return e(function(e){return n(e,o)})}:function(n){return $ngine.load(e,n,o)},l=r&&r.getModel?r.getModel:"function"==typeof n?function(e){n(e)}:"string"==typeof n?function(e){$ngine.load(n,e,o,!0)}:function(e){e(n)};return a(function(r,i,o){$ngine.cache[i]={url:e,elements:[],model:n},l(function(n,a,u){for(var c={url:e,model:n=void 0===n?{}:n,model_url:u,getModel:l,cache:{},id:i,template_url:o},s=$ngine.interpolate(r,$ngine.eval,0,c).toString(),d=function e(n){if(void 0===n)return[];if("function"==typeof n)return[n];if("string"==typeof n){if("#"==n[0])return[document.getElementById(n.substr(1))];if("."==n[0]){for(var t=[],r=document.getElementsByClassName(n.substr(1)),i=0;i<r.length;i++)t.push(r[i]);return t}for(var o=[],a=document.getElementsByTagName(n),l=0;l<a.length;l++)o.push(a[l]);return o}if(Array.isArray(n))return[].concat.apply([],n.map(e));console.log("invalid ngine.render callback:",n)}(t=void 0===t?"body":t),g=0;g<d.length;g++){var f=d[g];if("function"!=typeof f){f.innerHTML="";var p=document.createElement("div");f.appendChild(p),$ngine.apply(p,i,s)}else f(s,i)}})}),'<span id="'+o+'">loading..</span>'}},window.$ngine.loadConfig("ngine.json"),window.$ngine.version="0.5.8";
